<template>
  <div
    class="
      container
      mt-4
    "
  >
    <div
      class="row"
    >
      <div class="col">
        <h1>Organizations</h1>
      </div>
    </div>
    <div
      class="row"
    >
      <div class="
        col-12
        col-sm-6
      ">
        <h3>Please select your organization</h3>
        <span
          v-if="organizations.length <= 0"
        >
          No organizations present.
        </span>
        <div
            class="
              list-group
              mt-4
            "
        >
          <a
              v-for="org in organizations"
              :key="org.slug"
              :href="`/orgs/${org.slug}/boards`"
              class="list-group-item list-group-item-action">
            {{ org.name }}
          </a>
        </div>
      </div>
    </div>
    <div
      class="row"
    >
      <div
        class="
          col-12
          col-sm-6
        "      
      >
       <AddOrganizationForm/> 
      </div>
    </div>
  </div>
</template>

<script lang="ts">
import {defineComponent, Ref, ref} from "vue";
import {getOrganizations, Organization} from "@/composables/api";
import AddOrganizationForm from "@/components/orgs/AddOrganizationForm.vue"
import {getBus} from "@/bus";

const bus = getBus("organizations-list")

export default defineComponent({
  name: "OrganizationList",
  components: {
    AddOrganizationForm
  },
  setup() {
    const organizations:Ref<Organization[]> = ref([])
    const loadOrgs = () => {
      getOrganizations().then(val => {
        organizations.value = val
      })
    }
    bus.on("organizations:organization:submitted", loadOrgs)

    // initially load organizations
    loadOrgs()

    return {
      organizations
    }
  }
})
</script>

<style lang="scss" scoped>
  .container {
    color: #1976D2;
  }
</style>